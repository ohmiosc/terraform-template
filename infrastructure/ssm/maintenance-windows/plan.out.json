{"format_version":"1.1","terraform_version":"1.3.2","variables":{"environment":{"value":"development"},"environment_prefix":{"value":"dev"},"filter_key_tag":{"value":"tag:ssm"},"filter_value_tag":{"value":"shutdown"},"product":{"value":"test"},"region":{"value":"eu-west-1"},"service":{"value":"ssm"}},"planned_values":{"outputs":{"instance_id":{"sensitive":false,"type":["list","string"],"value":[]}},"root_module":{"resources":[{"address":"aws_iam_instance_profile.ssm-maintenance-profile","mode":"managed","type":"aws_iam_instance_profile","name":"ssm-maintenance-profile","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"name":"dev-test-ssm-ssm-profile","name_prefix":null,"path":"/","role":"dev-test-ssm-ssm-role","tags":null,"tags_all":{"Creator":"terraform - Hector","Environment":"dev","Product":"product","Project":"stop-ssm","Squad":"infraestructura"}},"sensitive_values":{"tags_all":{}}},{"address":"aws_iam_policy.start-stop-policy","mode":"managed","type":"aws_iam_policy","name":"start-stop-policy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":"ssm-instance-start-stop","name":"dev-test-ssm-ssm-temp","name_prefix":null,"path":"/","policy":"{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"VisualEditor0\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:StartInstances\",\n                \"ec2:StopInstances\",\n                \"ec2:DescribeInstanceStatus\"\n            ],\n            \"Resource\": \"*\"\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ssm:*\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ]\n        }\n    ]\n}\n","tags":null,"tags_all":{"Creator":"terraform - Hector","Environment":"dev","Product":"product","Project":"stop-ssm","Squad":"infraestructura"}},"sensitive_values":{"tags_all":{}}},{"address":"aws_iam_role.ssm-maintenance-role","mode":"managed","type":"aws_iam_role","name":"ssm-maintenance-role","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":[\"ssm.amazonaws.com\"]},\"Sid\":\"\"}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"dev-test-ssm-ssm-role","path":"/","permissions_boundary":null,"tags":null,"tags_all":{"Creator":"terraform - Hector","Environment":"dev","Product":"product","Project":"stop-ssm","Squad":"infraestructura"}},"sensitive_values":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}},{"address":"aws_iam_role_policy_attachment.ssm-attachment","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ssm-attachment","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"role":"dev-test-ssm-ssm-role"},"sensitive_values":{}},{"address":"aws_ssm_maintenance_window.window","mode":"managed","type":"aws_ssm_maintenance_window","name":"window","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"allow_unassociated_targets":false,"cutoff":0,"description":"Demo hector","duration":1,"enabled":true,"end_date":null,"name":"maintenance-window-stop-Instance","schedule":"rate(15 minutes)","schedule_offset":null,"schedule_timezone":"America/Lima","start_date":null,"tags":null,"tags_all":{"Creator":"terraform - Hector","Environment":"dev","Product":"product","Project":"stop-ssm","Squad":"infraestructura"}},"sensitive_values":{"tags_all":{}}},{"address":"aws_ssm_maintenance_window_target.target1","mode":"managed","type":"aws_ssm_maintenance_window_target","name":"target1","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":"This is a maintenance window target - Hector","name":"maintenance-window-target","owner_information":null,"resource_type":"INSTANCE","targets":[{"key":"tag:ssm","values":["shutdown"]}]},"sensitive_values":{"targets":[{"values":[false]}]}},{"address":"aws_ssm_maintenance_window_task.example","mode":"managed","type":"aws_ssm_maintenance_window_task","name":"example","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"cutoff_behavior":null,"description":"Stop Ec2 for Tag","max_concurrency":"2","max_errors":"1","name":null,"priority":1,"targets":[{"key":"WindowTargetIds"}],"task_arn":"AWS-StopEC2Instance","task_invocation_parameters":[{"automation_parameters":[{"document_version":"$LATEST","parameter":[{"name":"InstanceId","values":[]}]}],"lambda_parameters":[],"run_command_parameters":[],"step_functions_parameters":[]}],"task_type":"AUTOMATION"},"sensitive_values":{"targets":[{"values":[]}],"task_invocation_parameters":[{"automation_parameters":[{"parameter":[{"values":[]}]}],"lambda_parameters":[],"run_command_parameters":[],"step_functions_parameters":[]}]}}]}},"resource_changes":[{"address":"aws_iam_instance_profile.ssm-maintenance-profile","mode":"managed","type":"aws_iam_instance_profile","name":"ssm-maintenance-profile","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"name":"dev-test-ssm-ssm-profile","name_prefix":null,"path":"/","role":"dev-test-ssm-ssm-role","tags":null,"tags_all":{"Creator":"terraform - Hector","Environment":"dev","Product":"product","Project":"stop-ssm","Squad":"infraestructura"}},"after_unknown":{"arn":true,"create_date":true,"id":true,"tags_all":{},"unique_id":true},"before_sensitive":false,"after_sensitive":{"tags_all":{}}}},{"address":"aws_iam_policy.start-stop-policy","mode":"managed","type":"aws_iam_policy","name":"start-stop-policy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"ssm-instance-start-stop","name":"dev-test-ssm-ssm-temp","name_prefix":null,"path":"/","policy":"{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"VisualEditor0\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:StartInstances\",\n                \"ec2:StopInstances\",\n                \"ec2:DescribeInstanceStatus\"\n            ],\n            \"Resource\": \"*\"\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ssm:*\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ]\n        }\n    ]\n}\n","tags":null,"tags_all":{"Creator":"terraform - Hector","Environment":"dev","Product":"product","Project":"stop-ssm","Squad":"infraestructura"}},"after_unknown":{"arn":true,"id":true,"policy_id":true,"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags_all":{}}}},{"address":"aws_iam_role.ssm-maintenance-role","mode":"managed","type":"aws_iam_role","name":"ssm-maintenance-role","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":[\"ssm.amazonaws.com\"]},\"Sid\":\"\"}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"dev-test-ssm-ssm-role","path":"/","permissions_boundary":null,"tags":null,"tags_all":{"Creator":"terraform - Hector","Environment":"dev","Product":"product","Project":"stop-ssm","Squad":"infraestructura"}},"after_unknown":{"arn":true,"create_date":true,"id":true,"inline_policy":true,"managed_policy_arns":true,"name_prefix":true,"tags_all":{},"unique_id":true},"before_sensitive":false,"after_sensitive":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}}},{"address":"aws_iam_role_policy_attachment.ssm-attachment","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ssm-attachment","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"role":"dev-test-ssm-ssm-role"},"after_unknown":{"id":true,"policy_arn":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"aws_ssm_maintenance_window.window","mode":"managed","type":"aws_ssm_maintenance_window","name":"window","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"allow_unassociated_targets":false,"cutoff":0,"description":"Demo hector","duration":1,"enabled":true,"end_date":null,"name":"maintenance-window-stop-Instance","schedule":"rate(15 minutes)","schedule_offset":null,"schedule_timezone":"America/Lima","start_date":null,"tags":null,"tags_all":{"Creator":"terraform - Hector","Environment":"dev","Product":"product","Project":"stop-ssm","Squad":"infraestructura"}},"after_unknown":{"id":true,"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags_all":{}}}},{"address":"aws_ssm_maintenance_window_target.target1","mode":"managed","type":"aws_ssm_maintenance_window_target","name":"target1","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"This is a maintenance window target - Hector","name":"maintenance-window-target","owner_information":null,"resource_type":"INSTANCE","targets":[{"key":"tag:ssm","values":["shutdown"]}]},"after_unknown":{"id":true,"targets":[{"values":[false]}],"window_id":true},"before_sensitive":false,"after_sensitive":{"targets":[{"values":[false]}]}}},{"address":"aws_ssm_maintenance_window_task.example","mode":"managed","type":"aws_ssm_maintenance_window_task","name":"example","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"cutoff_behavior":null,"description":"Stop Ec2 for Tag","max_concurrency":"2","max_errors":"1","name":null,"priority":1,"targets":[{"key":"WindowTargetIds"}],"task_arn":"AWS-StopEC2Instance","task_invocation_parameters":[{"automation_parameters":[{"document_version":"$LATEST","parameter":[{"name":"InstanceId","values":[]}]}],"lambda_parameters":[],"run_command_parameters":[],"step_functions_parameters":[]}],"task_type":"AUTOMATION"},"after_unknown":{"arn":true,"id":true,"service_role_arn":true,"targets":[{"values":true}],"task_invocation_parameters":[{"automation_parameters":[{"parameter":[{"values":[]}]}],"lambda_parameters":[],"run_command_parameters":[],"step_functions_parameters":[]}],"window_id":true,"window_task_id":true},"before_sensitive":false,"after_sensitive":{"targets":[{"values":[]}],"task_invocation_parameters":[{"automation_parameters":[{"parameter":[{"values":[]}]}],"lambda_parameters":[],"run_command_parameters":[],"step_functions_parameters":[]}]}}}],"output_changes":{"instance_id":{"actions":["create"],"before":null,"after":[],"after_unknown":false,"before_sensitive":false,"after_sensitive":false}},"prior_state":{"format_version":"1.0","terraform_version":"1.3.2","values":{"outputs":{"instance_id":{"sensitive":false,"value":[],"type":["list","string"]}},"root_module":{"resources":[{"address":"data.aws_instances.instances_id","mode":"data","type":"aws_instances","name":"instances_id","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"filter":[{"name":"tag:ssm","values":["shutdown"]}],"id":"eu-west-1","ids":[],"instance_state_names":null,"instance_tags":null,"private_ips":[],"public_ips":[],"timeouts":null},"sensitive_values":{"filter":[{"values":[false]}],"ids":[],"private_ips":[],"public_ips":[]}}]}}},"configuration":{"provider_config":{"aws":{"name":"aws","full_name":"registry.terraform.io/hashicorp/aws","expressions":{"default_tags":[{"tags":{"constant_value":{"Creator":"terraform - Hector","Environment":"dev","Product":"product","Project":"stop-ssm","Squad":"infraestructura"}}}],"region":{"references":["var.region"]}}}},"root_module":{"outputs":{"instance_id":{"expression":{"references":["data.aws_instances.instances_id.ids","data.aws_instances.instances_id"]},"description":"ID of the EC2 instance"}},"resources":[{"address":"aws_iam_instance_profile.ssm-maintenance-profile","mode":"managed","type":"aws_iam_instance_profile","name":"ssm-maintenance-profile","provider_config_key":"aws","expressions":{"name":{"references":["var.environment_prefix","var.product","var.service"]},"role":{"references":["aws_iam_role.ssm-maintenance-role.name","aws_iam_role.ssm-maintenance-role"]}},"schema_version":0},{"address":"aws_iam_policy.start-stop-policy","mode":"managed","type":"aws_iam_policy","name":"start-stop-policy","provider_config_key":"aws","expressions":{"description":{"constant_value":"ssm-instance-start-stop"},"name":{"references":["var.environment_prefix","var.product","var.service"]},"policy":{"constant_value":"{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"VisualEditor0\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:StartInstances\",\n                \"ec2:StopInstances\",\n                \"ec2:DescribeInstanceStatus\"\n            ],\n            \"Resource\": \"*\"\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ssm:*\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ]\n        }\n    ]\n}\n"}},"schema_version":0},{"address":"aws_iam_role.ssm-maintenance-role","mode":"managed","type":"aws_iam_role","name":"ssm-maintenance-role","provider_config_key":"aws","expressions":{"assume_role_policy":{"constant_value":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": [\n          \"ssm.amazonaws.com\"\n          ]\n        },\n        \"Action\": \"sts:AssumeRole\"\n      }\n  ]\n}\n"},"name":{"references":["var.environment_prefix","var.product","var.service"]}},"schema_version":0},{"address":"aws_iam_role_policy_attachment.ssm-attachment","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ssm-attachment","provider_config_key":"aws","expressions":{"policy_arn":{"references":["aws_iam_policy.start-stop-policy.arn","aws_iam_policy.start-stop-policy"]},"role":{"references":["aws_iam_role.ssm-maintenance-role.name","aws_iam_role.ssm-maintenance-role"]}},"schema_version":0},{"address":"aws_ssm_maintenance_window.window","mode":"managed","type":"aws_ssm_maintenance_window","name":"window","provider_config_key":"aws","expressions":{"cutoff":{"constant_value":0},"description":{"constant_value":"Demo hector"},"duration":{"constant_value":1},"name":{"constant_value":"maintenance-window-stop-Instance"},"schedule":{"constant_value":"rate(15 minutes)"},"schedule_timezone":{"constant_value":"America/Lima"}},"schema_version":0},{"address":"aws_ssm_maintenance_window_target.target1","mode":"managed","type":"aws_ssm_maintenance_window_target","name":"target1","provider_config_key":"aws","expressions":{"description":{"constant_value":"This is a maintenance window target - Hector"},"name":{"constant_value":"maintenance-window-target"},"resource_type":{"constant_value":"INSTANCE"},"targets":[{"key":{"references":["var.filter_key_tag"]},"values":{"references":["var.filter_value_tag"]}}],"window_id":{"references":["aws_ssm_maintenance_window.window.id","aws_ssm_maintenance_window.window"]}},"schema_version":0},{"address":"aws_ssm_maintenance_window_task.example","mode":"managed","type":"aws_ssm_maintenance_window_task","name":"example","provider_config_key":"aws","expressions":{"description":{"constant_value":"Stop Ec2 for Tag"},"max_concurrency":{"constant_value":2},"max_errors":{"constant_value":1},"priority":{"constant_value":1},"service_role_arn":{"references":["aws_iam_role.ssm-maintenance-role.arn","aws_iam_role.ssm-maintenance-role"]},"targets":[{"key":{"constant_value":"WindowTargetIds"},"values":{"references":["aws_ssm_maintenance_window_target.target1.id","aws_ssm_maintenance_window_target.target1"]}}],"task_arn":{"constant_value":"AWS-StopEC2Instance"},"task_invocation_parameters":[{"automation_parameters":[{"document_version":{"constant_value":"$LATEST"},"parameter":[{"name":{"constant_value":"InstanceId"},"values":{"references":["data.aws_instances.instances_id.ids","data.aws_instances.instances_id"]}}]}]}],"task_type":{"constant_value":"AUTOMATION"},"window_id":{"references":["aws_ssm_maintenance_window.window.id","aws_ssm_maintenance_window.window"]}},"schema_version":0},{"address":"data.aws_instances.instances_id","mode":"data","type":"aws_instances","name":"instances_id","provider_config_key":"aws","expressions":{"filter":[{"name":{"references":["var.filter_key_tag"]},"values":{"references":["var.filter_value_tag"]}}]},"schema_version":0}],"variables":{"environment":{"default":"development","description":"The envrionment where it will be deployed"},"environment_prefix":{"default":"dev","description":"The envrionment prefix where it will be deployed"},"filter_key_tag":{"default":"tag:ssm","description":"The key Tag"},"filter_value_tag":{"default":"shutdown","description":"The value Tag"},"product":{"default":"test","description":"The name of the product."},"region":{"default":"eu-west-1","description":"AWS Region"},"service":{"default":"ssm","description":"The name service create"}}}},"relevant_attributes":[{"resource":"aws_iam_role.ssm-maintenance-role","attribute":["name"]},{"resource":"aws_iam_policy.start-stop-policy","attribute":["arn"]},{"resource":"aws_iam_role.ssm-maintenance-role","attribute":["arn"]},{"resource":"aws_ssm_maintenance_window_target.target1","attribute":["id"]},{"resource":"data.aws_instances.instances_id","attribute":["ids"]},{"resource":"aws_ssm_maintenance_window.window","attribute":["id"]}]}
